<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Study Buddy</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      height: 100%;
      background-size: cover;
      background-position: center;
      transition: background-image 0.5s ease;
      color: #fff;
    }

    .overlay {
      background: rgba(0, 0, 0, 0.6);
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    h1 {
      margin-bottom: 10px;
    }

    select, input[type="number"], button {
      margin: 10px 0;
      padding: 10px;
      font-size: 1rem;
      border-radius: 8px;
      border: none;
    }

    .hidden {
      display: none;
    }

    .persona-img {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 60px;
      height: 60px;
    }

    .timer-view {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #main-timer {
      font-size: 4rem;
      margin: 20px 0;
    }

    .progress-bar {
      width: 10px;
      background: rgba(255, 255, 255, 0.3);
      height: 200px;
      margin: 20px auto;
      position: relative;
    }

    .progress-fill {
      background: lime;
      width: 100%;
      position: absolute;
      bottom: 0;
    }

    .info-box {
      margin-top: 20px;
      font-size: 1.2rem;
    }

    @media (min-width: 768px) {
      .overlay {
        padding: 40px;
      }
    }
  </style>
</head>
<body>
  <div class="overlay" id="setup">
    <h1>ğŸ“ Study Buddy Setup</h1>

    <label>â³ Study Duration:
      <select id="duration">
        <option value="25">25 mins</option>
        <option value="50">50 mins</option>
        <option value="90">90 mins</option>
        <option value="custom">Custom</option>
      </select>
    </label>
    <input type="number" id="custom-duration" class="hidden" min="5" placeholder="Enter custom mins" />

    <label>ğŸ” Break Frequency:
      <select id="break-frequency"></select>
    </label>

    <label>â˜• Break Duration:
      <select id="break-duration">
        <option value="5">5 mins</option>
        <option value="10">10 mins</option>
        <option value="15">15 mins</option>
      </select>
    </label>

    <label>ğŸ­ Persona:
      <select id="persona">
        <option value="cat.png">ğŸ˜º Cat</option>
        <option value="male.png">ğŸ‘¨â€ğŸ“ Male PhD Student</option>
        <option value="female.png">ğŸ‘©â€ğŸ“ Female PhD Student</option>
      </select>
    </label>

    <label>ğŸ¨ Background:
      <select id="background">
        <option value="cafe.jpg">Cafe</option>
        <option value="library.jpg">Library</option>
        <option value="studyroom.jpg">Study Room</option>
      </select>
    </label>

    <button onclick="startSession()">Start Studying</button>
  </div>

  <div class="overlay hidden" id="timer-ui">
    <img id="persona-img" class="persona-img" />
    <div class="timer-view">
      <div id="main-timer">00:00</div>
      <div class="progress-bar"><div class="progress-fill" id="progress-fill"></div></div>
      <div class="info-box" id="info-box"></div>
    </div>
  </div>

  <audio id="ding-sound" src="ding.mp3" preload="auto"></audio>

  <script>
    const durationSelect = document.getElementById('duration');
    const customDurationInput = document.getElementById('custom-duration');
    const breakFrequencySelect = document.getElementById('break-frequency');
    const breakDurationSelect = document.getElementById('break-duration');
    const personaSelect = document.getElementById('persona');
    const backgroundSelect = document.getElementById('background');

    let totalDuration = 25;
    let breakPoints = [];
    let breakDuration = 5;
    let personaImg = '';
    let backgroundImg = '';
    let currentPhase = 'work';
    let phaseIndex = 0;
    let timer;
    let startTime;
    let phaseTimes = [];

    durationSelect.addEventListener('change', () => {
      if (durationSelect.value === 'custom') {
        customDurationInput.classList.remove('hidden');
      } else {
        customDurationInput.classList.add('hidden');
        updateBreakOptions(parseInt(durationSelect.value));
      }
    });

    customDurationInput.addEventListener('input', () => {
      updateBreakOptions(parseInt(customDurationInput.value));
    });

    function updateBreakOptions(duration) {
      breakFrequencySelect.innerHTML = '';
      if (!duration || duration < 5) return;
      [15, 30, 45].forEach(val => {
        if (val < duration) {
          const opt = document.createElement('option');
          opt.value = val;
          opt.textContent = `Break every ${val} mins`;
          breakFrequencySelect.appendChild(opt);
        }
      });
    }

    function startSession() {
      totalDuration = durationSelect.value === 'custom'
        ? parseInt(customDurationInput.value)
        : parseInt(durationSelect.value);

      const breakFreq = parseInt(breakFrequencySelect.value);
      breakDuration = parseInt(breakDurationSelect.value);
      personaImg = personaSelect.value;
      backgroundImg = backgroundSelect.value;

      breakPoints = [];
      for (let i = breakFreq; i < totalDuration; i += breakFreq) {
        breakPoints.push(i);
      }

      // Calculate all phases
      phaseTimes = [];
      let time = 0;
      for (let i = 0; i < breakPoints.length; i++) {
        phaseTimes.push({ type: 'work', duration: breakPoints[i] - time });
        time = breakPoints[i];
        phaseTimes.push({ type: 'break', duration: breakDuration });
        time += breakDuration;
      }
      if (time < totalDuration) {
        phaseTimes.push({ type: 'work', duration: totalDuration - time });
      }

      // Switch views
      document.getElementById('setup').classList.add('hidden');
      document.getElementById('timer-ui').classList.remove('hidden');

      // Apply background and persona
      document.body.style.backgroundImage = `url(${backgroundImg})`;
      document.getElementById('persona-img').src = personaImg;

      startPhase();
    }

    function startPhase() {
      const current = phaseTimes[phaseIndex];
      currentPhase = current.type;
      const totalSecs = current.duration * 60;
      startTime = Date.now();

      playDing();
      updateInfoBox();

      timer = setInterval(() => {
        const elapsed = Math.floor((Date.now() - startTime) / 1000);
        const remaining = totalSecs - elapsed;

        if (remaining <= 0) {
          clearInterval(timer);
          phaseIndex++;
          if (phaseIndex < phaseTimes.length) {
            startPhase();
          } else {
            document.getElementById('main-timer').textContent = "ğŸ‰ Done!";
            document.getElementById('info-box').textContent = "";
          }
        } else {
          document.getElementById('main-timer').textContent = formatTime(remaining);
          const pct = (elapsed / totalSecs) * 100;
          document.getElementById('progress-fill').style.height = `${pct}%`;
          updateInfoBox(remaining);
        }
      }, 500);
    }

    function updateInfoBox(secs = null) {
      const next = currentPhase === 'work' ? 'break' : 'work';
      const msg = currentPhase === 'work' ? 'Next break in' : 'Work resumes in';
      const duration = secs !== null ? formatTime(secs) : '';
      document.getElementById('info-box').textContent = `${msg} ${duration}`;
    }

    function formatTime(seconds) {
      const m = String(Math.floor(seconds / 60)).padStart(2, '0');
      const s = String(seconds % 60).padStart(2, '0');
      return `${m}:${s}`;
    }

    function playDing() {
      document.getElementById('ding-sound').play();
    }

    // Initial break options setup
    updateBreakOptions(totalDuration);
  </script>
</body>
</html>

